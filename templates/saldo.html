{% extends 'base.html' %}

{% block title %}GHOST SMM{% endblock %}

{% block content %}
<!-- Page Content -->
<main class="py-2 px-2 sm:px-3 bg-gray-50 dark:bg-gray-900">
    
    <div x-data="{ show: true }" x-show="show" x-transition
         class="bg-orange-500 text-white p-2 text-sm font-semibold rounded-lg mb-2 shadow animate-wave flex items-center justify-between gap-2">
        <p class="flex-grow">üéâ ¬°Tu primera recarga en Free Fire en nuestra web puede salirte a mitad de precio!
        Pregunta por WhatsApp si tu ID es v√°lido para la promoci√≥n üî•</p>
        <button @click="show = false" class="flex-shrink-0 text-white hover:text-opacity-75">
            <i class="fas fa-times"></i>
        </button>
    </div>
      <div x-data="{ show: true }" x-show="show" x-transition
         class="bg-orange-500 text-white p-2 text-sm font-semibold rounded-lg mb-2 shadow animate-wave flex items-center justify-between gap-2">
        <p class="flex-grow">Para acreditar tu saldo deves mandar el comprobante por whatsapp</p>
        <button @click="show = false" class="flex-shrink-0 text-white hover:text-opacity-75">
            <i class="fas fa-times"></i>
        </button>
    </div>
    
    <div class="py-3 sm:py-12 bg-gray-50 dark:bg-gray-900">
        <div class="w-full mx-auto px-1 sm:px-6 lg:px-8">
            <div class="bg-white dark:bg-gray-800 overflow-hidden shadow-sm rounded-lg">
                <div class="p-2 sm:p-6 text-gray-900 dark:text-gray-200">
                    
                    <!-- Amount Input -->
                    <div class="mb-6">
                        <label for="amount" class="block text-sm font-medium text-gray-900 dark:text-gray-200">Monto a agregar (USD)</label>
                        <div class="mt-1 relative rounded-md shadow-sm">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <span class="text-gray-600 dark:text-gray-400 sm:text-sm">$</span>
                            </div>
                            <input type="number" name="amount" id="amount" 
                                class="pl-7 block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:border-blue-500 dark:focus:border-blue-400 focus:ring-blue-500 dark:focus:ring-blue-400"
                                placeholder="10"
                                step="1"
                                min="1"
                                max="1000">
                        </div>
                    </div>

                    <!-- Payment Method Selection -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-900 dark:text-gray-200 mb-3">M√©todo de pago</label>
                        <div class="mt-2 grid grid-cols-1 md:grid-cols-2 gap-3">
                            
                            <!-- PAYPAL -->
                            <button type="button" id="paypalBtn" class="relative flex items-start p-4 border border-gray-200 dark:border-gray-600 rounded-lg cursor-pointer hover:border-blue-500 dark:hover:border-blue-400 transition-colors duration-200">
                                <div class="ml-3 flex flex-row items-center flex-grow gap-2">
                                    <div class="flex-shrink-0 flex items-center justify-center bg-white dark:bg-gray-700 rounded-xl border border-gray-200 dark:border-gray-600 h-16 w-16 sm:h-20 sm:w-20">
                                        <i class="fab fa-paypal text-blue-600 text-4xl sm:text-5xl"></i>
                                    </div>
                                    <div class="flex flex-col justify-center flex-grow">
                                        <p class="text-lg sm:text-xl font-bold text-gray-900 dark:text-gray-200 leading-tight">Pay Pal | Desde 10$ USD</p>
                                        <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-400 mt-1">Worldwide Payments
                                            <span class="block sm:inline sm:before:content-['‚Ä¢'] sm:before:mx-1">
                                                Fee: $0.40 + 7.00%
                                            </span>
                                        </p>
                                    </div>
                                </div>
                            </button>

                            <!-- BINANCE PAY -->
                            <button type="button" id="binanceBtn" class="relative flex items-start p-4 border border-gray-200 dark:border-gray-600 rounded-lg cursor-pointer hover:border-yellow-500 dark:hover:border-yellow-400 transition-colors duration-200">
                                <div class="ml-3 flex flex-row items-center flex-grow gap-2">
                                    <div class="flex-shrink-0 flex items-center justify-center bg-white dark:bg-gray-700 rounded-xl border border-gray-200 dark:border-gray-600 h-16 w-16 sm:h-20 sm:w-20">
                                        <i class="fab fa-btc text-yellow-500 text-4xl sm:text-5xl"></i>
                                    </div>
                                    <div class="flex flex-col justify-center flex-grow">
                                        <p class="text-lg sm:text-xl font-bold text-gray-900 dark:text-gray-200 leading-tight">BINANCE PAY / QR / $1 USDT</p>
                                        <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-400 mt-1">[Automatic] Binance Pay with QR Code</p>
                                    </div>
                                </div>
                            </button>

                            <!-- TRANSFERENCIA -->
                            <button type="button" id="transferBtn" class="relative flex items-start p-4 border border-gray-200 dark:border-gray-600 rounded-lg cursor-pointer hover:border-purple-500 dark:hover:border-purple-400 transition-colors duration-200">
                                <div class="ml-3 flex flex-row items-center flex-grow gap-2">
                                    <div class="flex-shrink-0 flex items-center justify-center bg-white dark:bg-gray-700 rounded-xl border border-gray-200 dark:border-gray-600 h-16 w-16 sm:h-20 sm:w-20">
                                        <div class="h-12 w-12 sm:h-16 sm:w-16 bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center rounded-xl">
                                            <i class="fas fa-university text-blue-600 text-xl sm:text-2xl"></i>
                                        </div>
                                    </div>
                                    <div class="flex flex-col justify-center flex-grow">
                                        <p class="text-lg sm:text-xl font-bold text-gray-900 dark:text-gray-200 leading-tight">Paga con transferencia</p>
                                        <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-400 mt-1">
                                            <span class="block sm:inline sm:before:content-['‚Ä¢'] sm:before:mx-1">Solo Mexico</span>
                                        </p>
                                    </div>
                                </div>
                            </button>
                            
                            <!-- OXXO -->
                            <button type="button" id="oxxoBtn" class="relative flex items-start p-4 border border-gray-200 dark:border-gray-600 rounded-lg cursor-pointer hover:border-red-500 dark:hover:border-red-400 transition-colors duration-200">
                                <div class="ml-3 flex flex-row items-center flex-grow gap-2">
                                    <div class="flex-shrink-0 flex items-center justify-center bg-white dark:bg-gray-700 rounded-xl border border-gray-200 dark:border-gray-600 h-16 w-16 sm:h-20 sm:w-20">
                                        <div class="h-12 w-12 sm:h-16 sm:w-16 bg-red-100 dark:bg-red-900/30 flex items-center justify-center rounded-xl">
                                            <i class="fas fa-store text-red-600 text-xl sm:text-2xl"></i>
                                        </div>
                                    </div>
                                    <div class="flex flex-col justify-center flex-grow">
                                        <p class="text-lg sm:text-xl font-bold text-gray-900 dark:text-gray-200 leading-tight">Paga con dep√≥sito en OXXO</p>
                                        <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-400 mt-1">
                                            <span class="block sm:inline sm:before:content-['‚Ä¢'] sm:before:mx-1">Pago en efectivo en tiendas OXXO</span>
                                        </p>
                                    </div>
                                </div>
                            </button>

                        </div>
                    </div>

                    <!-- Terms -->
                    <div class="mb-6">
                        <label class="flex items-center space-x-2 text-sm text-gray-700 dark:text-gray-300">
                            <input type="checkbox" 
                                   name="terms_accepted"
                                   id="terms_accepted"
                                   required
                                   class="rounded border-gray-300 dark:border-gray-700 text-blue-600 dark:text-blue-400 focus:ring-blue-500 dark:focus:ring-blue-400">
                            <span>
                                Adem√°s de aceptar los <a href="/terminos" target="_blank" class="text-blue-600 dark:text-blue-400 hover:underline">T√©rminos y Condiciones</a>
                            </span>
                        </label>
                        <div class="mt-2 text-xs text-gray-600 dark:text-gray-400 pl-6">
                            <p>Reconozco que los fondos agregados son NO reembolsables y todo el saldo introducido solo podr√° ser utilizado dentro de la plataforma. Me comprometo a no presentar disputas fraudulentas ni solicitudes de devoluci√≥n de cargo. Entiendo que cualquier intento de fraude o pr√°ctica deshonesta resultar√° en la suspensi√≥n permanente de la cuenta, acciones legales y ser√° denunciado ante las autoridades correspondientes.</p>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</main>

<!-- MODALES -->

<!-- PayPal Modal -->
<div id="paypalModal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 opacity-0 pointer-events-none transition-opacity duration-300">
    <div class="modal-content bg-white dark:bg-gray-800 rounded-lg shadow-2xl p-6 w-full max-w-md mx-auto relative transform scale-95 opacity-0 transition-all duration-300">
        <span class="close absolute top-3 right-3 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 text-3xl font-bold cursor-pointer">&times;</span>
        <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100 mb-4 text-center">Mandar Comprobante de pago por WhatsApp üì≤</h2>
        <p class="text-gray-700 dark:text-gray-300 mb-2 text-center text-sm">Las comisiones de PayPal ser√°n descontadas al actualizar su saldo.</p>
        <p class="text-gray-700 dark:text-gray-300 mb-4 text-center font-semibold">El correo de PayPal es: <span class="text-blue-600 dark:text-blue-400 break-all">33hackeryt@gmail.com</span></p>
        <button type="button" id="createOrderBtn" class="btn paypal-btn w-full flex items-center justify-center px-6 py-3 bg-blue-700 hover:bg-blue-800 text-white font-semibold rounded-lg shadow-md transition duration-200 ease-in-out">
            <i class="fas fa-money-check-alt mr-2"></i> Crear Orden de Pago
        </button>
    </div>
</div>

<!-- Binance Modal -->
<div id="binanceModal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 opacity-0 pointer-events-none transition-opacity duration-300">
    <div class="modal-content bg-white dark:bg-gray-800 rounded-lg shadow-2xl p-6 w-full max-w-md mx-auto relative transform scale-95 opacity-0 transition-all duration-300">
        <span class="close absolute top-3 right-3 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 text-3xl font-bold cursor-pointer">&times;</span>
        <p class="exito copyed bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-200 py-2 px-4 rounded-md text-center mb-4 opacity-0 transition-opacity duration-300 absolute w-11/12 left-1/2 -translate-x-1/2 -top-12">ID copiado exitosamente üéâ</p>
        <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100 mb-4 text-center">Paga mediante Binance Pay üí∞</h2>
        <p class="text-gray-700 dark:text-gray-300 mb-3 text-center">Por favor, paga al siguiente ID:</p>
        <div class="flex items-center justify-center space-x-2 mb-6">
            <input type="text" value="1051744842" readonly id="binanceID"
                   class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm
                          bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-center font-mono select-all
                          focus:outline-none cursor-text">
            <i class="fa-solid fa-copy text-gray-500 hover:text-blue-500 cursor-pointer text-xl" onclick="copiarBinanceID()" title="Copiar ID"></i>
        </div>
        <button type="button" id="createOrderBinanceBtn" class="btn binance-btn w-full flex items-center justify-center px-6 py-3 bg-yellow-500 hover:bg-yellow-600 text-gray-900 font-semibold rounded-lg shadow-md transition duration-200 ease-in-out">
            <i class="fas fa-clipboard-check mr-2"></i> Crear Orden de Pago
        </button>
    </div>
</div>

<!-- Transfer Modal -->
<div id="transferModal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 opacity-0 pointer-events-none transition-opacity duration-300">
    <div class="modal-content bg-white dark:bg-gray-800 rounded-lg shadow-2xl p-6 w-full max-w-md mx-auto relative transform scale-95 opacity-0 transition-all duration-300">
        <span class="close absolute top-3 right-3 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 text-3xl font-bold cursor-pointer">&times;</span>
        <p class="exito copyed bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-200 py-2 px-4 rounded-md text-center mb-4 opacity-0 transition-opacity duration-300 absolute w-11/12 left-1/2 -translate-x-1/2 -top-12">Clave copiada exitosamente üéâ</p>
        <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100 mb-4 text-center">Paga mediante Transferencia üè¶</h2>
        <p class="text-gray-700 dark:text-gray-300 mb-3 text-center">Clave:</p>
        <div class="flex items-center justify-center space-x-2 mb-6">
            <input type="text" value="728969000023825614" readonly id="claveTransfer"
                   class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm
                          bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-center font-mono select-all
                          focus:outline-none cursor-text">
            <i class="fa-solid fa-copy text-gray-500 hover:text-blue-500 cursor-pointer text-xl" onclick="copiarNumeroTransfer()" title="Copiar Clave"></i>
        </div>
        <p class="text-gray-700 dark:text-gray-300 mb-6 text-center text-sm font-medium">Concepto: <span class="font-bold text-blue-600 dark:text-blue-400">Pago "{{ usuario }}"</span></p>
        <button type="button" id="createOrderTransferBtn" class="btn transfer-btn w-full flex items-center justify-center px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white font-semibold rounded-lg shadow-md transition duration-200 ease-in-out">
            <i class="fas fa-paper-plane mr-2"></i> Crear Orden de Pago
        </button>
    </div>
</div>

<!-- OXXO Modal -->
<div id="oxxoModal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 opacity-0 pointer-events-none transition-opacity duration-300">
    <div class="modal-content bg-white dark:bg-gray-800 rounded-lg shadow-2xl p-6 w-full max-w-md mx-auto relative transform scale-95 opacity-0 transition-all duration-300">
        <span class="close absolute top-3 right-3 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 text-3xl font-bold cursor-pointer">&times;</span>
        <p class="exito copyed bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-200 py-2 px-4 rounded-md text-center mb-4 opacity-0 transition-opacity duration-300 absolute w-11/12 left-1/2 -translate-x-1/2 -top-12">Clave OXXO copiada exitosamente üéâ</p>
        <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100 mb-4 text-center">Deposita en OXXO üè™</h2>
        <p class="text-gray-700 dark:text-gray-300 mb-3 text-center">N√∫mero de Tarjeta OXXO:</p>
        <div class="flex items-center justify-center space-x-2 mb-6">
            <input type="text" value="2242 1702 1012 1364" readonly id="claveOxxo"
                   class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm
                          bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-center font-mono select-all
                          focus:outline-none cursor-text">
            <i class="fa-solid fa-copy text-gray-500 hover:text-blue-500 cursor-pointer text-xl" onclick="copiarNumeroOxxo()" title="Copiar Clave OXXO"></i>
        </div>
        <button type="button" id="createOrderOxxoBtn" class="btn oxxo-btn w-full flex items-center justify-center px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg shadow-md transition duration-200 ease-in-out">
            <i class="fas fa-cash-register mr-2"></i> Crear Orden de Pago
        </button>
    </div>
</div>

<!-- Thank You Modal -->
<div id="thankYouModal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 opacity-0 pointer-events-none transition-opacity duration-300">
    <div class="modal-content bg-white dark:bg-gray-800 rounded-lg shadow-2xl p-6 w-full max-w-md mx-auto relative transform scale-95 opacity-0 transition-all duration-300">
        <span class="close absolute top-3 right-3 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 text-3xl font-bold cursor-pointer">&times;</span>
        <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100 mb-4 text-center">¬°Gracias por tu pago! üéâ</h2>
        <p class="text-gray-700 dark:text-gray-300 mb-6 text-center">
            Tu pago de <span class="font-bold text-green-600 dark:text-green-400" id="finalMonto"></span>
            mediante <span class="font-bold text-blue-600 dark:text-blue-400" id="finalMetodoPago"></span>
            ha sido procesado. Recibir√°s una notificaci√≥n cuando tu saldo se actualice. ¬°Agradecemos tu paciencia!
        </p>
        <button type="button" id="whatsappButton" class="btn whatsapp-btn w-full flex items-center justify-center px-6 py-3 bg-green-500 hover:bg-green-600 text-white font-semibold rounded-lg shadow-md transition duration-200 ease-in-out">
            <i class="fab fa-whatsapp mr-2"></i> Enviar Comprobante por WhatsApp
        </button>
    </div>
</div>

<style>
    @keyframes wave {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.01); }
    }
    .animate-wave {
        animation: wave 2s infinite ease-in-out;
    }
</style>

<script>
    // Variables globales para almacenar el estado del pago
    var usuario = "{{ usuario }}"; // Obtenido del backend (Flask)
    var monto = 0; // Monto que el usuario desea agregar
    var metodoPago = ""; // M√©todo de pago seleccionado
    var currentOpenModal = null; // Referencia al modal actualmente abierto

    /**
     * Muestra un modal aplicando clases de Tailwind para animaci√≥n.
     * @param {HTMLElement} modalElement - El elemento DOM del modal a mostrar.
     */
    function showModal(modalElement) {
        if (currentOpenModal && currentOpenModal !== modalElement) {
            hideModal(currentOpenModal); // Oculta el modal anterior si hay uno abierto
        }
        modalElement.classList.remove('opacity-0', 'pointer-events-none');
        modalElement.classList.add('opacity-100', 'pointer-events-auto');
        // Animar el contenido interno del modal
        modalElement.querySelector('.modal-content').classList.remove('scale-95', 'opacity-0');
        modalElement.querySelector('.modal-content').classList.add('scale-100', 'opacity-100');
        currentOpenModal = modalElement;
    }

    /**
     * Oculta un modal aplicando clases de Tailwind para animaci√≥n.
     * @param {HTMLElement} modalElement - El elemento DOM del modal a ocultar.
     */
    function hideModal(modalElement) {
        // Animar el contenido interno del modal primero
        modalElement.querySelector('.modal-content').classList.remove('scale-100', 'opacity-100');
        modalElement.querySelector('.modal-content').classList.add('scale-95', 'opacity-0');
        // Despu√©s de un breve retraso para que la animaci√≥n del contenido se vea, oculta el overlay
        setTimeout(() => {
            modalElement.classList.remove('opacity-100', 'pointer-events-auto');
            modalElement.classList.add('opacity-0', 'pointer-events-none');
            currentOpenModal = null; // Reinicia la referencia al modal abierto
            // Aseg√∫rate de ocultar cualquier mensaje de copiado que est√© visible
            document.querySelectorAll('.copyed').forEach(msg => {
                msg.classList.remove('opacity-100');
                msg.classList.add('opacity-0');
            });
        }, 200); // Coincide con la duraci√≥n de transici√≥n del modal-content
    }

    /**
     * Validar que el monto est√© ingresado y los t√©rminos aceptados
     */
    function validateForm() {
        const amountInput = document.getElementById("amount");
        const termsCheckbox = document.getElementById("terms_accepted");
        
        if (!amountInput.value || parseFloat(amountInput.value) <= 0) {
            alert("Por favor, ingresa un monto v√°lido y mayor que cero.");
            amountInput.focus();
            return false;
        }
        
        if (!termsCheckbox.checked) {
            alert("Por favor, acepta los t√©rminos y condiciones.");
            termsCheckbox.focus();
            return false;
        }
        
        monto = parseFloat(amountInput.value);
        return true;
    }

    /**
     * Env√≠a los detalles del pago al backend.
     * @param {string} user - El nombre de usuario.
     * @param {number} amount - El monto de la recarga.
     * @param {string} paymentMethod - El m√©todo de pago.
     */
    function guardarPago(user, amount, paymentMethod) {
        fetch('/guardar_pago', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                usuario: user,
                monto: amount,
                metodo_pago: paymentMethod,
                estado: 'pendiente' // Estado inicial del pago
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                console.log('Pago guardado exitosamente');
            } else {
                console.error('Error al guardar el pago:', data.error);
                alert('Hubo un error al registrar tu pago. Por favor, intenta de nuevo.');
            }
        })
        .catch(error => {
            console.error('Error en la solicitud:', error);
            alert('No se pudo conectar con el servidor para registrar el pago.');
        });
    }

    /**
     * Crea una orden de pago y muestra el modal de agradecimiento.
     */
    function crearOrdenDePago() {
        // Guarda el pago en la base de datos (simulado)
        guardarPago(usuario, monto, metodoPago);

        // Oculta el modal de instrucciones actual
        if (currentOpenModal) {
            hideModal(currentOpenModal);
        }

        // Actualiza el monto y m√©todo de pago en el modal de agradecimiento
        document.getElementById('finalMonto').textContent = `$${monto}`;
        document.getElementById('finalMetodoPago').textContent = metodoPago;

        // Muestra el modal de gracias
        showModal(document.getElementById("thankYouModal"));
    }

    // --- Manejadores de eventos para los botones de m√©todo de pago ---
    document.getElementById("paypalBtn").addEventListener('click', function() {
        if (!validateForm()) return;
        metodoPago = "PayPal";
        showModal(document.getElementById("paypalModal"));
    });

    document.getElementById("binanceBtn").addEventListener('click', function() {
        if (!validateForm()) return;
        metodoPago = "Binance";
        showModal(document.getElementById("binanceModal"));
    });

    document.getElementById("transferBtn").addEventListener('click', function() {
        if (!validateForm()) return;
        metodoPago = "Transferencia";
        showModal(document.getElementById("transferModal"));
    });

    document.getElementById("oxxoBtn").addEventListener('click', function() {
        if (!validateForm()) return;
        metodoPago = "OXXO";
        showModal(document.getElementById("oxxoModal"));
    });

    // Asigna los eventos de click a los botones "Crear Orden de Pago" dentro de cada modal
    document.getElementById("createOrderBtn").addEventListener('click', crearOrdenDePago);
    document.getElementById("createOrderBinanceBtn").addEventListener('click', crearOrdenDePago);
    document.getElementById("createOrderTransferBtn").addEventListener('click', crearOrdenDePago);
    document.getElementById("createOrderOxxoBtn").addEventListener('click', crearOrdenDePago);

    // --- L√≥gica para cerrar modales ---
    // Cerrar modales cuando se hace clic en la "X"
    document.querySelectorAll(".modal .close").forEach(span => {
        span.addEventListener('click', function() {
            hideModal(this.closest('.modal')); // Oculta el modal padre del bot√≥n de cierre
        });
    });

    // Cerrar modales al hacer clic fuera del contenido del modal
    document.querySelectorAll(".modal").forEach(modal => {
        modal.addEventListener('click', function(event) {
            // Si el click fue directamente en el overlay (el modal mismo, no en su contenido)
            if (event.target === this) {
                hideModal(this);
            }
        });
    });

    // --- L√≥gica para el bot√≥n de WhatsApp ---
    document.getElementById("whatsappButton").addEventListener('click', function() {
        var mensaje = `¬°Hola! Acabo de recargar saldo en el Panel Ghost. Mi usuario es ${usuario} y he a√±adido ${monto} por el m√©todo de ${metodoPago}. Env√≠o mi comprobante de pago en un momento.`;
        var whatsappUrl = `https://wa.me/524661002589?text=${encodeURIComponent(mensaje)}`;
        window.open(whatsappUrl, '_blank');
    });

    // --- Funciones para copiar IDs/Claves y mostrar feedback ---
    function copiarBinanceID() {
        const input = document.getElementById('binanceID');
        input.select();
        input.setSelectionRange(0, 99999); // Para dispositivos m√≥viles
        document.execCommand('copy');

        const mensaje = document.querySelector('#binanceModal .copyed');
        mensaje.classList.remove('opacity-0');
        mensaje.classList.add('opacity-100');

        setTimeout(() => {
            mensaje.classList.remove('opacity-100');
            mensaje.classList.add('opacity-0');
        }, 2000);
    }

    function copiarNumeroTransfer() {
        const input = document.getElementById('claveTransfer');
        input.select();
        input.setSelectionRange(0, 99999); // Para dispositivos m√≥viles
        document.execCommand('copy');

        const mensaje = document.querySelector('#transferModal .copyed');
        mensaje.classList.remove('opacity-0');
        mensaje.classList.add('opacity-100');

        setTimeout(() => {
            mensaje.classList.remove('opacity-100');
            mensaje.classList.add('opacity-0');
        }, 2000);
    }

    function copiarNumeroOxxo() {
        const input = document.getElementById('claveOxxo');
        input.select();
        input.setSelectionRange(0, 99999); // Para dispositivos m√≥viles
        document.execCommand('copy');

        const mensaje = document.querySelector('#oxxoModal .copyed');
        mensaje.classList.remove('opacity-0');
        mensaje.classList.add('opacity-100');

        setTimeout(() => {
            mensaje.classList.remove('opacity-100');
            mensaje.classList.add('opacity-0');
        }, 2000);
    }
</script>

{% endblock %}