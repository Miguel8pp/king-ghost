{% extends 'base.html' %}

{% block title %}Free Fire Likes - GHOST SMM{% endblock %}

{% block content %}
<div class="py-6 px-4 sm:px-6 lg:px-8">
    <!-- Page Header -->
    <div class="mb-8">
        <div class="flex items-center space-x-3 mb-4">
            <div class="flex-shrink-0">
                <div class="w-12 h-12 bg-gradient-to-br from-red-500 to-orange-600 rounded-xl flex items-center justify-center shadow-lg">
                    <i class="fas fa-heart text-white text-xl"></i>
                </div>
            </div>
            <div>
                <h1 class="text-3xl font-bold text-gray-900 dark:text-white">Free Fire Likes</h1>
                <p class="text-gray-600 dark:text-gray-400">Envía likes a tus amigos de forma rápida y gratuita</p>
            </div>
        </div>
        
        <!-- Stats Cards -->
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
            <div class="bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-10 h-10 bg-green-100 dark:bg-green-900/20 rounded-lg flex items-center justify-center">
                            <i class="fas fa-check-circle text-green-600 dark:text-green-400"></i>
                        </div>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Estado</p>
                        <p class="text-lg font-semibold text-gray-900 dark:text-white">Activo</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900/20 rounded-lg flex items-center justify-center">
                            <i class="fas fa-clock text-blue-600 dark:text-blue-400"></i>
                        </div>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Tiempo de entrega</p>
                        <p class="text-lg font-semibold text-gray-900 dark:text-white">Instantáneo</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-10 h-10 bg-purple-100 dark:bg-purple-900/20 rounded-lg flex items-center justify-center">
                            <i class="fas fa-gift text-purple-600 dark:text-purple-400"></i>
                        </div>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Precio</p>
                        <p class="text-lg font-semibold text-gray-900 dark:text-white">Gratis</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Form Section -->
    <div class="max-w-2xl mx-auto">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden">
            <div class="px-6 py-8 sm:px-8">
                <form id="form-like" class="space-y-6">
                    <!-- UID Input -->
                    <div>
                        <label for="uid" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            <i class="fas fa-user mr-2 text-socialmentorify"></i>
                            ID del Jugador (UID)
                        </label>
                        <div class="relative">
                            <input 
                                type="text" 
                                id="uid" 
                                name="uid" 
                                placeholder="Ingresa el UID del jugador aquí"
                                class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-xl text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-socialmentorify dark:focus:ring-socialmentorify-dark focus:border-transparent transition-all duration-200"
                                required
                            >
                            <div class="absolute inset-y-0 right-0 flex items-center pr-4">
                                <i class="fas fa-gamepad text-gray-400 dark:text-gray-500"></i>
                            </div>
                        </div>
                        <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">
                            <i class="fas fa-info-circle mr-1"></i>
                            Encuentra tu UID en la configuración del juego
                        </p>
                    </div>

                    <!-- Submit Button -->
                  <button 
    type="submit" 
    id="submit-btn"
    class="w-full bg-gradient-to-r from-socialmentorify to-green-400 hover:from-green-400 hover:to-socialmentorify text-black dark:text-white font-bold py-4 px-6 rounded-xl transform transition-all duration-300 hover:scale-[1.02] hover:shadow-lg hover:shadow-socialmentorify/30 focus:outline-none focus:ring-2 focus:ring-socialmentorify focus:ring-offset-2 focus:ring-offset-white dark:focus:ring-offset-gray-800 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
>
    <span class="flex items-center justify-center gap-3">
        <i id="btn-icon" class="fas fa-heart text-lg"></i>
        <span id="btn-text" class="text-lg">Enviar Likes Gratis</span>
    </span>
</button>

                </form>
            </div>
        </div>

        <!-- Results Section -->
        <div id="resultado-container" class="mt-8 transition-all duration-500 hidden opacity-0 transform translate-y-4">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden">
                <div class="px-6 py-8 sm:px-8">
                    <div class="flex items-center gap-4 mb-6">
                        <div id="result-icon-wrapper" class="w-12 h-12 rounded-full flex items-center justify-center">
                            <!-- Icon injected dynamically -->
                        </div>
                        <div>
                            <h3 id="result-title" class="text-xl font-bold text-gray-900 dark:text-white"></h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Resultado de la operación</p>
                        </div>
                    </div>
                    <div id="result-content" class="space-y-4">
                        <!-- Content injected dynamically -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Instructions -->
        <div class="mt-8 bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-2xl p-6 border border-blue-200 dark:border-blue-700/50">
            <div class="flex items-start gap-4">
                <div class="flex-shrink-0">
                    <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center">
                        <i class="fas fa-info-circle text-blue-600 dark:text-blue-400"></i>
                    </div>
                </div>
                <div>
                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">¿Cómo funciona?</h4>
                    <ul class="space-y-2 text-sm text-gray-700 dark:text-gray-300">
                        <li class="flex items-center gap-2">
                            <i class="fas fa-check-circle text-green-500 text-xs"></i>
                            Ingresa el UID del jugador de Free Fire
                        </li>
                        <li class="flex items-center gap-2">
                            <i class="fas fa-check-circle text-green-500 text-xs"></i>
                            Haz clic en "Enviar Likes Gratis"
                        </li>
                        <li class="flex items-center gap-2">
                            <i class="fas fa-check-circle text-green-500 text-xs"></i>
                            Los likes se envían automáticamente
                        </li>
                        <li class="flex items-center gap-2">
                            <i class="fas fa-clock text-blue-500 text-xs"></i>
                            Límite: 100 likes por jugador cada 24 horas
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Loading Overlay -->
<div id="loading-overlay" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center hidden">
    <div class="bg-white dark:bg-gray-800 rounded-2xl p-8 text-center shadow-2xl border border-gray-200 dark:border-gray-700 max-w-sm mx-4">
        <div class="w-16 h-16 border-4 border-socialmentorify border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
        <p class="text-gray-900 dark:text-white font-semibold text-lg mb-2">Enviando likes...</p>
        <p class="text-gray-600 dark:text-gray-400 text-sm">Por favor espera un momento</p>
    </div>
</div>

<script>
    document.getElementById('form-like').addEventListener('submit', async function(e) {
        e.preventDefault();

        const uid = document.getElementById('uid').value.trim();
        if (!uid) {
            showError("El UID es obligatorio para enviar likes.");
            return;
        }

        const submitBtn = document.getElementById('submit-btn');
        const btnText = document.getElementById('btn-text');
        const btnIcon = document.getElementById('btn-icon');
        const loadingOverlay = document.getElementById('loading-overlay');
        const resultContainer = document.getElementById('resultado-container');

        // Hide previous results
        resultContainer.classList.add('hidden', 'opacity-0', 'translate-y-4');

        // Loading state
        submitBtn.disabled = true;
        btnText.textContent = 'Enviando...';
        btnIcon.className = 'fas fa-spinner animate-spin text-lg';
        loadingOverlay.classList.remove('hidden');

        const formData = new FormData();
        formData.append('uid', uid);

        try {
            const res = await fetch('/getLikes', {
                method: 'POST',
                body: formData
            });

            const json = await res.json();

            if (json.success) {
                showSuccess(json.data);
            } else {
                showError(json.error || "Error desconocido al enviar likes");
            }
        } catch (err) {
            showError("Error de conexión. Verifica tu conexión a internet y vuelve a intentar.");
        } finally {
            // Restore button state
            submitBtn.disabled = false;
            btnText.textContent = 'Enviar Likes Gratis';
            btnIcon.className = 'fas fa-heart text-lg';
            loadingOverlay.classList.add('hidden');
        }
    });

    function showSuccess(data) {
        const resultContainer = document.getElementById('resultado-container');
        const resultTitle = document.getElementById('result-title');
        const resultIconWrapper = document.getElementById('result-icon-wrapper');
        const resultContent = document.getElementById('result-content');

        // Reset classes
        resultIconWrapper.className = 'w-12 h-12 rounded-full flex items-center justify-center animate-bounce';
        resultContent.className = 'space-y-4';

        if (data.status !== "success") {
            // Warning/Info case
            resultIconWrapper.classList.add('bg-yellow-100', 'dark:bg-yellow-900/20');
            resultIconWrapper.innerHTML = '<i class="fas fa-exclamation-triangle text-yellow-600 dark:text-yellow-400 text-xl"></i>';
            resultTitle.textContent = data.titulo || "Información";
            resultTitle.className = 'text-xl font-bold text-yellow-800 dark:text-yellow-200';

            let contentHtml = '';
            if (data.mensagem) {
                contentHtml += `<div class="bg-yellow-50 dark:bg-yellow-900/10 border border-yellow-200 dark:border-yellow-700/50 rounded-xl p-4">
                    <p class="text-yellow-800 dark:text-yellow-200 font-medium">${data.mensagem}</p>
                </div>`;
            }
            if (data.dica) {
                contentHtml += `<div class="bg-blue-50 dark:bg-blue-900/10 border border-blue-200 dark:border-blue-700/50 rounded-xl p-4">
                    <p class="text-blue-800 dark:text-blue-200"><i class="fas fa-lightbulb mr-2"></i>${data.dica}</p>
                </div>`;
            }
            if (data.dicas && data.dicas.length > 0) {
                contentHtml += `<div class="bg-blue-50 dark:bg-blue-900/10 border border-blue-200 dark:border-blue-700/50 rounded-xl p-4">
                    <h5 class="font-semibold text-blue-800 dark:text-blue-200 mb-2"><i class="fas fa-lightbulb mr-2"></i>Consejos:</h5>
                    <ul class="space-y-1 text-blue-700 dark:text-blue-300">
                        ${data.dicas.map(d => `<li class="flex items-start gap-2"><i class="fas fa-arrow-right text-xs mt-1.5"></i>${d}</li>`).join('')}
                    </ul>
                </div>`;
            }
            resultContent.innerHTML = contentHtml;
        } else {
            // Success case
            resultIconWrapper.classList.add('bg-green-100', 'dark:bg-green-900/20');
            resultIconWrapper.innerHTML = '<i class="fas fa-check-circle text-green-600 dark:text-green-400 text-xl"></i>';
            resultTitle.textContent = data.titulo || "¡Likes enviados exitosamente!";
            resultTitle.className = 'text-xl font-bold text-green-800 dark:text-green-200';

            let contentHtml = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-gray-50 dark:bg-gray-700/50 rounded-xl p-4 border border-gray-200 dark:border-gray-600">
                        <h5 class="font-semibold text-gray-900 dark:text-white mb-3 flex items-center gap-2">
                            <i class="fas fa-user text-socialmentorify"></i>
                            Información del Jugador
                        </h5>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-600 dark:text-gray-400">Nickname:</span>
                                <span class="font-medium text-gray-900 dark:text-white">${data.player.nickname}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600 dark:text-gray-400">UID:</span>
                                <span class="font-mono text-gray-900 dark:text-white">${data.player.uid}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600 dark:text-gray-400">Región:</span>
                                <span class="font-medium text-gray-900 dark:text-white">${data.player.region}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600 dark:text-gray-400">Nivel:</span>
                                <span class="font-medium text-gray-900 dark:text-white">${data.player.level}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600 dark:text-gray-400">EXP:</span>
                                <span class="font-medium text-gray-900 dark:text-white">${data.player.exp}</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-xl p-4 border border-green-200 dark:border-green-700/50">
                        <h5 class="font-semibold text-green-800 dark:text-green-200 mb-3 flex items-center gap-2">
                            <i class="fas fa-heart text-red-500"></i>
                            Estadísticas de Likes
                        </h5>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-green-700 dark:text-green-300">Likes Anteriores:</span>
                                <span class="font-bold text-green-800 dark:text-green-200">${data.likes.antes}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-green-700 dark:text-green-300">Likes Actuales:</span>
                                <span class="font-bold text-green-800 dark:text-green-200">${data.likes.depois}</span>
                            </div>
                            <div class="flex justify-between border-t border-green-200 dark:border-green-700 pt-2">
                                <span class="text-green-700 dark:text-green-300 font-medium">Likes Añadidos:</span>
                                <span class="font-bold text-green-800 dark:text-green-200 text-lg">+${data.likes.adicionados}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-green-700 dark:text-green-300">Límite Diario:</span>
                                <span class="font-medium text-green-800 dark:text-green-200">${data.likes.limite_diario}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            if (data.agradecimento) {
                contentHtml += `<div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-xl p-4 text-center transition-colors duration-300">
  <p class="text-blue-800 dark:text-blue-100 italic">
    <i class="fas fa-quote-left mr-2"></i>${data.agradecimento}<i class="fas fa-quote-right ml-2"></i>
  </p>
</div>
`;
            }

            resultContent.innerHTML = contentHtml;
        }

        // Show result with animation
        resultContainer.classList.remove('hidden');
        setTimeout(() => {
            resultContainer.classList.remove('opacity-0', 'translate-y-4');
        }, 10);
        
        // Smooth scroll to result
        setTimeout(() => {
            resultContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 300);
    }

    function showError(message) {
    const resultContainer = document.getElementById('resultado-container');
    const resultTitle = document.getElementById('result-title');
    const resultIconWrapper = document.getElementById('result-icon-wrapper');
    const resultContent = document.getElementById('result-content');

    // Reset classes con soporte para modo claro/oscuro
    resultIconWrapper.className = 'w-12 h-12 rounded-full flex items-center justify-center animate-bounce bg-red-100 dark:bg-red-900/20';
    resultContent.className = 'space-y-4';

    // Ícono de error adaptado a ambos modos
    resultIconWrapper.innerHTML = '<i class="fas fa-times-circle text-red-600 dark:text-red-400 text-xl"></i>';

    // Título del error con color dinámico
    resultTitle.textContent = "Error al enviar likes";
    resultTitle.className = 'text-xl font-bold text-red-800 dark:text-red-100';

    // Contenido del mensaje de error
    resultContent.innerHTML = `
        <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 rounded-xl p-4 transition-colors duration-300">
            <p class="text-red-800 dark:text-red-100 font-medium flex items-center gap-2">
                <i class="fas fa-exclamation-circle"></i>
                ${message}
            </p>
        </div>
    `;



        // Show result with animation
        resultContainer.classList.remove('hidden');
        setTimeout(() => {
            resultContainer.classList.remove('opacity-0', 'translate-y-4');
        }, 10);
        
        setTimeout(() => {
            resultContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 300);
    }
</script>
{% endblock %}